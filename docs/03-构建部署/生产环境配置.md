# ç”Ÿäº§ç¯å¢ƒé…ç½®

## é…ç½®åŸŸåå’Œ HTTPS

### 1. ä¿®æ”¹ Nginx é…ç½®

```bash
vim docker/nginx/nginx.conf
```

ä¿®æ”¹ `server_name`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ”¹ä¸ºä½ çš„åŸŸå
    # ...
}
```

### 2. é…ç½® SSL è¯ä¹¦ï¼ˆä½¿ç”¨ Let's Encryptï¼‰

```bash
# å®‰è£… certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

## é…ç½®è‡ªåŠ¨å¯åŠ¨

Docker Compose å·²é…ç½® `restart: always`ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨é‡å¯ã€‚å¦‚éœ€ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨ï¼š

```bash
# åˆ›å»º systemd æœåŠ¡ï¼ˆå¯é€‰ï¼‰
sudo vim /etc/systemd/system/yl-app.service
```

```ini
[Unit]
Description=YL Application
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/app
ExecStart=/usr/bin/docker-compose -f docker-compose.prod.yml up -d
ExecStop=/usr/bin/docker-compose -f docker-compose.prod.yml down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨æœåŠ¡
sudo systemctl enable yl-app.service
sudo systemctl start yl-app.service
```

## æ•°æ®å¤‡ä»½

### å¤‡ä»½ MySQL æ•°æ®

åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼š

```bash
vim /opt/app/backup.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
docker-compose -f /opt/app/docker-compose.prod.yml exec -T mysql mysqldump -uroot -p${DB_PASSWORD} ${DB_DATABASE} > $BACKUP_DIR/db_$DATE.sql

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz /opt/app/backend/uploads

# åˆ é™¤ 7 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x /opt/app/backup.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ ï¼š0 2 * * * /opt/app/backup.sh
```

## å®‰å…¨é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

- ä¿®æ”¹ `DB_PASSWORD` ä¸ºå¼ºå¯†ç 
- ä¿®æ”¹ `JWT_SECRET` ä¸ºéšæœºå­—ç¬¦ä¸²
- ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 

### 2. é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload
```

### 3. é™åˆ¶æ•°æ®åº“è®¿é—®

ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
- ä¸æš´éœ² MySQL ç«¯å£åˆ°å…¬ç½‘
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸæ›´æ–°å¯†ç 

## æ€§èƒ½ä¼˜åŒ–

### 1. Nginx é…ç½®ä¼˜åŒ–

```nginx
# å¯ç”¨ Gzip å‹ç¼©
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript;
```

### 2. æ•°æ®åº“ä¼˜åŒ–

- å®šæœŸä¼˜åŒ–è¡¨
- æ·»åŠ å¿…è¦çš„ç´¢å¼•
- ç›‘æ§æ…¢æŸ¥è¯¢

### 3. åº”ç”¨ä¼˜åŒ–

- å¯ç”¨ç”Ÿäº§æ¨¡å¼ï¼š`NODE_ENV=production`
- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº
- å¯ç”¨ç¼“å­˜

## ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# æ—¥å¿—è½®è½¬ï¼ˆå¯é€‰ï¼‰
# é…ç½® logrotate æˆ–ä½¿ç”¨ Docker æ—¥å¿—é©±åŠ¨
```

### 2. å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æ£€æŸ¥æœåŠ¡å“åº”
curl http://localhost/api
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](./éƒ¨ç½²æŒ‡å—.md) - æœåŠ¡å™¨éƒ¨ç½²æµç¨‹
- [æ•…éšœæ’æŸ¥](./æ•…éšœæ’æŸ¥.md) - å¸¸è§é—®é¢˜è§£å†³

